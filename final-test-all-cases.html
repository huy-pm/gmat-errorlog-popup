<!DOCTYPE html>
<html>
<head>
    <title>GMAT Verbal Scraping - Final Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin-bottom: 30px; padding: 20px; border: 1px solid #ccc; }
        .test-case h2 { color: #333; }
        button { padding: 10px 15px; margin: 5px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #results { margin-top: 20px; padding: 15px; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <h1>GMAT Verbal Scraping - Final Test</h1>
    <p>Click the buttons below to test the updated gmatclub-verbal-scraping.js script with each test case.</p>
    
    <div class="test-case">
        <h2>Test Case 1</h2>
        <button onclick="runTestCase(1)">Run Verbal Scraper on Test Case 1</button>
        <div class="post-wrapper first-post">
            <div class="post-info add-bookmark">
                <div class="item text">
                    Scientists studying climate change have found that global warming results not only in higher planetary temperatures but also in earlier springs and later autumns. While some argue that this shift is advantageous due to longer summer growing seasons, others fear that many animal species may be unable to adapt, increasing their risk of extinction.<br>       <br>Which of the following, if true, provides the strongest evidence that longer summer growing seasons caused by global warming will increase the risk of extinction for some animal species?   <br><br>a/ Squirrels and chipmunks store larger quantities of nuts due to longer summers, but these supplies spoil more rapidly in warmer winters, leaving fewer edible reserves.<br>B: Fungus species that typically produce spores annually now produce them twice in longer summers, disrupting the diets of animals that depend on them.<br>(C) Butterfly caterpillars, responding to earlier springs, now mature into butterflies before certain bird species hatch chicks that rely exclusively on these caterpillars for food.<br>D; Salmon migrating earlier accumulate lower fat reserves, greatly reducing survival rates during migration and decreasing the number reaching breeding sites each year.<br>E/ Reptiles forced to emerge earlier from hibernation spend more time foraging before mating, reducing their available energy for reproduction.
                    <div class="item twoRowsBlock">
                        <div class="upRow" onclick="hideAnswer(this,'spoiler_1416212');">
                            <a href="javascript:void(0)">
                                <span class="show">Show</span><span class="hide">Hide</span> Answer
                            </a>
                            <div class="answer-block">
                                <a class="btn-show-answer text-white" role="button">
                                    <span class="icon-svg icon-svg-forum-question-banks"></span>
                                    <span class="tooltiptext">Official Answer</span>
                                </a>
                                <div id="spoiler_1416212" class="downRow">C</div>
                            </div>
                        </div>
                    </div>
                    <br>_________________<br>
                    <div class="post_signature" style="max-height: none;">
                        <div class="content" style="max-height: none;"><span style="font-weight: bold">New to the GMAT Club?</span><br><ul>• Questions: <a href="https://gmatclub.com/forum/search.php?view=search_tags" class="postlink-local">Question Bank</a> | <a href="https://gmatclub.com/forum/bunuel-s-signature-collection-all-in-one-topic-357638.html" class="postlink-local">Bunuel's Signature Collection</a><br>• Tests: <a href="https://gmatclub.com/gmat-focus-tests/" class="postlink-local">GMAT Club Tests</a> | <a href="https://gmatclub.com/forum/quiz.php?menu=1" class="postlink-local">Forum Quiz</a><br>• Guides: <a href="https://gmatclub.com/forum/view_important_topics.php?f=7&amp;sk=t&amp;sd=d" class="postlink-local">Quantitative</a> | <a href="https://gmatclub.com/forum/verbal-guides-and-resources-389/" class="postlink-local">Verbal</a> | <a href="https://gmatclub.com/forum/ultimate-gmat-quantitative-megathread-244512.html" class="postlink-local">Ultimate Quantitative Collection</a> | <a href="https://gmatclub.com/forum/new-to-the-math-forum-please-read-this-first-140445.html" class="postlink-local">All You Need for Quant</a><br>• Rules: <a href="https://gmatclub.com/forum/rules-for-posting-please-read-this-before-posting-133935.html" class="postlink-local">Quantitative</a> | <a href="https://gmatclub.com/forum/rules-to-post-on-the-verbal-forum-208733.html" class="postlink-local">Verbal</a></ul></div>
                        <div class="prompt" style="display: none;"><a class="button" href="#">Signature Read More</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-case">
        <h2>Test Case 2</h2>
        <button onclick="runTestCase(2)">Run Verbal Scraper on Test Case 2</button>
        <div class="post-wrapper first-post">
            <div class="post-info add-bookmark">
                <div class="item text">
                    MoviesNow! streaming service is projected to buy more licenses to stream more movies in the next 5 years than in any previous 5-year window. This is because MoviesNow!’s board of directors has encouraged the pursuit of subscribers who are parents of children under the age of 12 and the current selection of movies to stream in the MoviesNow! database is targeted at subscribers ages 18–35.<br><br>Which of the following, if true, would most strengthen the argument from MoviesNow!’s board of directors that they should pursue subscribers who are parents of children under the age of 12?<br><br>A: The board monitors the demographic targets of large advertising companies and chooses target audiences for their streaming service based off those trends.<br>B: A population study conducted by an independent research group has uncovered a large uptick in the number of parents who are raising children under the age of 12.<br>C: People aged 18–35 generally have less disposable income than other age demographics.<br>D: The licensing agreement MoviesNow! has with the largest movie production company is set to expire within the next 5 years.<br>E: The board of MoviesNow! is comprised of parents of children under the age of 12.
                    <div class="item twoRowsBlock">
                        <div class="upRow" onclick="hideAnswer(this,'spoiler_2090119');">
                            <a href="javascript:void(0)">
                                <span class="show">Show</span><span class="hide">Hide</span> Answer
                            </a>
                            <div class="answer-block">
                                <a class="btn-show-answer text-white" role="button">
                                    <span class="icon-svg icon-svg-forum-question-banks"></span>
                                    <span class="tooltiptext">Official Answer</span>
                                </a>
                                <div id="spoiler_2090119" class="downRow">B</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-case">
        <h2>Test Case 3</h2>
        <button onclick="runTestCase(3)">Run Verbal Scraper on Test Case 3</button>
        <div class="post-wrapper first-post">
            <div class="post-info add-bookmark">
                <div class="item text">
                    It is now known that to get the maximum out of a car engine one can do two things- use high octane fuel, which contains additives that extend the life and efficiency of the engine, or get the engine flushed at regular intervals, which removes all harmful substances from the engine. It has been shown by several studies that the use of high octane fuel is up to three times more effective in extending the life of the car engine than is the use of engine flushing. This does not, however, mean that engine flushing can play no role in extending the life of a car engine, because ______________________.<br><br>Which of the following logically completes the argument?<br><br>A) some studies have shown that using high octane fuel can lead to problems with a car's exhaust system.<br>B) high octane fuel costs much more than regular fuel and this cost is expected to increase even further over the next few years.<br>C) many car mechanics recommend the use of engine flushing over the use of high octane fuels.<br>D) the benefits of using high octane fuel are independent of the benefits of engine flushing.<br>E) Engine flushing when not done by expert mechanics, can cause permanent damage to the engine of the car.
                    <div class="item twoRowsBlock">
                        <div class="upRow" onclick="hideAnswer(this,'spoiler_1294068');">
                            <a href="javascript:void(0)">
                                <span class="show">Show</span><span class="hide">Hide</span> Answer
                            </a>
                            <div class="answer-block">
                                <a class="btn-show-answer text-white" role="button">
                                    <span class="icon-svg icon-svg-forum-question-banks"></span>
                                    <span class="tooltiptext">Official Answer</span>
                                </a>
                                <div id="spoiler_1294068" class="downRow">D</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-case">
        <h2>Test Case 4</h2>
        <button onclick="runTestCase(4)">Run Verbal Scraper on Test Case 4</button>
        <div class="post-wrapper first-post">
            <div class="post-info add-bookmark">
                <div class="item text">
                    The vomeronasal organ (VNO) is found inside the noses of various animals. While its structural development and function are clearer in other animals, most humans have a VNO that is detectable, though only microscopically. When researchers have been able to stimulate VNO cells in humans, the subjects have reported experiencing subtle smell sensations. It seems, then, that the VNO, though not completely understood, is a functioning sensory organ in most humans.<br><br>Which one of the following, if true, most weakens the argument?<br><br>(A) It is not known whether the researchers succeeded in stimulating only VNO cells in the human subjects' noses.<br><br>(B) Relative to its occurrence in certain other animals, the human VNO appears to be anatomically rudimentary and underdeveloped.<br><br>(C) Certain chemicals that play a leading role in the way the VNO functions in animals in which it is highly developed do not appear to play a role in its functioning in humans.<br><br>(D) Secondary anatomical structures associated with the VNO in other animals seem to be absent in humans.<br><br>(E) For many animal species, the VNO is thought to subtly enhance the sense of smell.
                    <div class="item twoRowsBlock">
                        <div class="upRow" onclick="hideAnswer(this,'spoiler_3266167');">
                            <a href="javascript:void(0)">
                                <span class="show">Show</span><span class="hide">Hide</span> Answer
                            </a>
                            <div class="answer-block">
                                <a class="btn-show-answer text-white" role="button">
                                    <span class="icon-svg icon-svg-forum-question-banks"></span>
                                    <span class="tooltiptext">Official Answer</span>
                                </a>
                                <div id="spoiler_3266167" class="downRow">A</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-case">
        <h2>Test Case 5</h2>
        <button onclick="runTestCase(5)">Run Verbal Scraper on Test Case 5</button>
        <div class="post-wrapper first-post">
            <div class="post-info add-bookmark">
                <div class="item text">
                    The popular belief that a snake's age can be determined by counting the number of layers of scales on its body is generally true. However, to help regulate its internal temperature, the outermost layers of scales of the Black Mamba snake often peel away when the temperature exceeding 120 degrees Fahrenheit, leaving the snake with fewer layers of scales than it would otherwise have. So only if the temperature in the Black Mamba's environment never exceeds 120 degrees Fahrenheit will its layers be a reliable measure of the snake's age.<br><br>Which of the following is an assumption on which the argument above depends? <br><br><br><br>A)    The growth of new layers of scales in a snake is not a function of levels of its basal metabolic rate.<br><br>B)    Only the Black Mamba loses layers of scales because of excessive heat. <br><br>C)    One day of temperatures above 120 degrees Fahrenheit will cause the Black Mamba snake to lose a layer of scales.<br><br>D)    The layers of scales of all snakes are of uniform thickness.<br><br>E)    The number of layers of scales that will be lost when the temperature exceeds 120 degrees Fahrenheit is not predictable.<br><br>Vercules                                                                <div class="item twoRowsBlock">
                                    <div class="upRow" onclick="hideAnswer(this,'spoiler_1184417');">
                                        <a href="javascript:void(0)">
                                            <span class="show">Show</span><span class="hide">Hide</span> Answer
                                        </a>
                                        <div class="answer-block">
                                            <a class="btn-show-answer text-white" role="button">
                                                <span class="icon-svg icon-svg-forum-question-banks"></span>
                                                <span class="tooltiptext">Official Answer</span>
                                            </a>
                                            <div id="spoiler_1184417" class="downRow">E</div>
                                        </div>
                                    </div>
                                </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Function to hide/show answers
        function hideAnswer(element, spoilerId) {
            var spoiler = document.getElementById(spoilerId);
            if (spoiler.style.display === 'none') {
                spoiler.style.display = 'block';
                element.querySelector('.show').style.display = 'none';
                element.querySelector('.hide').style.display = 'inline';
            } else {
                spoiler.style.display = 'none';
                element.querySelector('.show').style.display = 'inline';
                element.querySelector('.hide').style.display = 'none';
            }
        }
        
        // Function to run the updated gmatclub-verbal-scraping.js script on a specific test case
        function runTestCase(testCaseNumber) {
            // Get the specific test case container
            var testCaseContainers = document.querySelectorAll('.test-case');
            var selectedContainer = testCaseContainers[testCaseNumber - 1];
            
            if (!selectedContainer) {
                alert("Test case " + testCaseNumber + " not found!");
                return;
            }
            
            // Temporarily hide other test cases to avoid DOM conflicts
            var otherContainers = Array.from(testCaseContainers).filter(function(container, index) {
                return index !== testCaseNumber - 1;
            });
            
            otherContainers.forEach(function(container) {
                container.style.display = 'none';
            });
            
            // Run the scraping logic (copy of the updated gmatclub-verbal-scraping.js)
            try {
                var e = selectedContainer.querySelector('.post-wrapper.first-post');
                if (!e) {
                    alert("Could not find the first post wrapper!");
                    // Restore visibility
                    otherContainers.forEach(function(container) {
                        container.style.display = '';
                    });
                    return;
                }
                
                var t = e.querySelector('.post-info.add-bookmark');
                if (!t) {
                    alert("Could not find the post-info add-bookmark section!");
                    // Restore visibility
                    otherContainers.forEach(function(container) {
                        container.style.display = '';
                    });
                    return;
                }
                
                var n = t.querySelector('.item.text');
                if (!n) {
                    alert("Could not find the item text div!");
                    // Restore visibility
                    otherContainers.forEach(function(container) {
                        container.style.display = '';
                    });
                    return;
                }
                
                var o = n.cloneNode(true);
                o.querySelectorAll('.item.twoRowsBlock,.post_signature').forEach(function(e) {
                    e.remove();
                });
                
                var h = o.innerHTML.replace(/\r?\n|\r/g, "");
                
                // Find where answer choices begin - look for multiple patterns
                // More comprehensive pattern matching for answer sections
                var answerSectionStart = -1;
                var answerPatterns = [
                    "<br><br>\\(", // For (A) format
                    "<br><br>[A-Za-z][.:;)/]", // For A., A), A:, A;, A/, A) formats (both uppercase and lowercase)
                    "<br><br>[A-Za-z]\\s", // For A followed by space
                    "<br><br>&lt;[A-Za-z]&gt;" // For <A> format
                ];
                
                // Try to find the first occurrence of any answer pattern
                for (var i = 0; i < answerPatterns.length; i++) {
                    var pattern = new RegExp(answerPatterns[i]);
                    var match = h.search(pattern);
                    if (match !== -1 && (answerSectionStart === -1 || match < answerSectionStart)) {
                        answerSectionStart = match;
                    }
                }
                
                var questionHTML = '';
                var answersHTML = '';
                
                if (answerSectionStart !== -1) {
                    // Split content at the answer choices
                    questionHTML = h.substring(0, answerSectionStart).trim();
                    var answersPart = h.substring(answerSectionStart).trim();
                    
                    // Extract answer choices by splitting on <br> and filtering
                    var answerLines = answersPart.split("<br>");
                    var answerChoices = [];
                    
                    // More comprehensive regex for answer detection
                    // Matches: (A), (a), A., a., A), a), A:, a:, A;, a;, A/, a/, A, a followed by space or content
                    var answerRegex = /^\([A-Za-z]\)|^[A-Za-z][.:;)/]?|^([A-Za-z])\s+|^&lt;[A-Za-z]&gt;/;
                    
                    for (var i = 0; i < answerLines.length; i++) {
                        var line = answerLines[i].trim();
                        // Check for answer patterns with more comprehensive regex
                        if (line.length > 0 && answerRegex.test(line)) {
                            answerChoices.push(line);
                        }
                    }
                    
                    // Format answers for display - ALWAYS in format "A. [Answer choice]"
                    answersHTML = answerChoices.map(function(choice) {
                        // Comprehensive conversion to standard A. format
                        return choice
                            // Convert (A) format to A.
                            .replace(/^\(([A-Za-z])\)/, '$1.')
                            // Convert A:, a:, A;, a;, A/, a/, A), a) formats to A.
                            .replace(/^([A-Za-z])[:;)/]/, '$1.')
                            // Convert <A> format to A.
                            .replace(/^&lt;([A-Za-z])&gt;/, '$1.')
                            // Convert A.    (with extra spaces) to A. (single space)
                            .replace(/^([A-Za-z])\.\s+/, '$1. ')
                            // Ensure there's a period after the letter if missing
                            .replace(/^([A-Za-z])\s+/, '$1. ')
                            // Fallback for any remaining formats
                            .replace(/^([A-Za-z])(\s+|$)/, '$1. ');
                    }).join("<br>");
                } else {
                    // Fallback: if we can't find answer choices, treat everything as question
                    questionHTML = h;
                    answersHTML = "No answer choices found";
                }
                
                // Extract passage and question
                var passage = "";
                var question = "";
                
                // Robust approach: Split by <br> and intelligently identify the question
                var parts = questionHTML.split("<br>");
                var questionIndex = -1;
                
                // Look for the question part - it's typically the last meaningful part with a question mark
                // or contains key question words
                for (var i = parts.length - 1; i >= 0; i--) {
                    var part = parts[i].trim();
                    // Skip empty parts
                    if (part.length === 0) continue;
                    
                    // Look for question patterns
                    if ((part.includes("?") && (part.toLowerCase().includes("which") || 
                                               part.toLowerCase().includes("what") || 
                                               part.toLowerCase().includes("how") || 
                                               part.toLowerCase().includes("why") || 
                                               part.toLowerCase().includes("except:")))) {
                        questionIndex = i;
                        question = part;
                        break;
                    }
                }
                
                // Fallback: if we didn't find a specific pattern, look for any text ending with ?
                if (questionIndex === -1) {
                    for (var i = parts.length - 1; i >= 0; i--) {
                        var part = parts[i].trim();
                        if (part.length > 0 && part.includes("?")) {
                            questionIndex = i;
                            question = part;
                            break;
                        }
                    }
                }
                
                if (questionIndex >= 0) {
                    // Build passage from parts before the question
                    var passageParts = parts.slice(0, questionIndex);
                    passage = passageParts.join(" ").trim();
                } else {
                    // If no question found, treat everything as passage
                    passage = questionHTML;
                }
                
                // Clean up passage - remove HTML tags and normalize
                passage = passage
                    .replace(/<br\s*\/?>/gi, '\n')          // Convert <br> to newlines
                    .replace(/<[^>]*>/g, '')                 // Remove HTML tags
                    .replace(/&ldquo;/g, '"')                // Convert HTML entities
                    .replace(/&rdquo;/g, '"')
                    .replace(/&amp;/g, '&')
                    .replace(/&[a-zA-Z0-9#]+;/g, '')        // Remove any remaining HTML entities
                    .trim();
                
                // Clean up question
                question = question
                    .replace(/<br\s*\/?>/gi, ' ')            // Convert <br> to spaces
                    .replace(/<[^>]*>/g, '')                 // Remove HTML tags
                    .replace(/&ldquo;/g, '"')                // Convert HTML entities
                    .replace(/&rdquo;/g, '"')
                    .replace(/&amp;/g, '&')
                    .replace(/&[a-zA-Z0-9#]+;/g, '')        // Remove any remaining HTML entities
                    .trim();
                
                // Clean up answers
                var cleanAnswers = answersHTML
                    .replace(/<br\s*\/?>/gi, '\n')
                    .replace(/<[^>]*>/g, '')
                    .replace(/&ldquo;/g, '"')
                    .replace(/&rdquo;/g, '"')
                    .replace(/&amp;/g, '&')
                    .replace(/&[a-zA-Z0-9#]+;/g, '')
                    .trim();
                
                // Restore visibility of other test cases
                otherContainers.forEach(function(container) {
                    container.style.display = '';
                });
                
                // Create popup window
                var popup = window.open("", "Extracted Data - Test Case " + testCaseNumber, "width=800,height=700,scrollbars=yes");
                popup.document.write(
                    '<html>' +
                    '<head>' +
                        '<title>Extracted Data - Test Case ' + testCaseNumber + '</title>' +
                        '<style>' +
                            'body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }' +
                            'h2 { color: #333; border-bottom: 2px solid #333; padding-bottom: 5px; }' +
                            'pre { background: #f4f4f4; padding: 15px; border-left: 4px solid #333; white-space: pre-wrap; word-wrap: break-word; }' +
                            '.section { margin-bottom: 30px; }' +
                        '</style>' +
                    '</head>' +
                    '<body>' +
                        '<div class="section">' +
                            '<h2>Passage</h2>' +
                            '<pre>' + passage + '</pre>' +
                        '</div>' +
                        '<div class="section">' +
                            '<h2>Question</h2>' +
                            '<pre>' + question + '</pre>' +
                        '</div>' +
                        '<div class="section">' +
                            '<h2>Answer Choices</h2>' +
                            '<pre>' + cleanAnswers + '</pre>' +
                        '</div>' +
                        '<div class="section">' +
                            '<h2>Test Case</h2>' +
                            '<pre>' + testCaseNumber + '</pre>' +
                        '</div>' +
                    '</body>' +
                    '</html>'
                );
                
            } catch (s) {
                // Restore visibility of other test cases
                otherContainers.forEach(function(container) {
                    container.style.display = '';
                });
                
                alert("Error occurred: " + (s.message || s));
            }
        }
    </script>
</body>
</html>